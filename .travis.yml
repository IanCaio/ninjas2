language: c++
branches:
  except:
  - automatic
cache:
  directories:
  - download
matrix:
  include:
  - os: linux
    sudo: required
    dist: trusty
    env:
    - _BUILD=win32
    - _MINGW=mingw32
    - _HOST=i686-w64-mingw32
    before_install:
    - sudo add-apt-repository ppa:kxstudio-debian/kxstudio -y
    - sudo add-apt-repository ppa:kxstudio-debian/mingw -y
    - sudo add-apt-repository ppa:kxstudio-debian/toolchain -y
    - sudo apt-get update -qq
    - sudo apt-get install kxstudio-repos
    - sudo apt-get update -qq
    install:
    - 'sudo apt-get install -y g++ pkg-config "${_MINGW}"-x-gcc "${_MINGW}"-x-pkgconfig
      wine

'
    script:
    - bash .travis/script-mingw.sh
    - cp -drfv bin ninjas2-"$_BUILD"
    - rm -f ninjas2-"$_BUILD"/README
    - install -d release
    - zip -9 -r release/ninjas2-"$_BUILD".zip ninjas2-"$_BUILD"
  - os: linux
    sudo: required
    dist: trusty
    env:
    - _BUILD=win64
    - _MINGW=mingw64
    - _HOST=x86_64-w64-mingw32
    before_install:
    - sudo add-apt-repository ppa:kxstudio-debian/kxstudio -y
    - sudo add-apt-repository ppa:kxstudio-debian/mingw -y
    - sudo add-apt-repository ppa:kxstudio-debian/toolchain -y
    - sudo apt-get update -qq
    - sudo apt-get install kxstudio-repos
    - sudo apt-get update -qq
    install:
    - 'sudo apt-get install -y g++ pkg-config "${_MINGW}"-x-gcc "${_MINGW}"-x-pkgconfig
      wine

'
    script:
    - bash .travis/script-mingw.sh
    - cp -drfv bin ninjas2-"$_BUILD"
    - rm -f ninjas2-"$_BUILD"/README
    - install -d release
    - zip -9 -r release/ninjas2-"$_BUILD".zip ninjas2-"$_BUILD"
  - os: osx
    sudo: required
    env:
    - _BUILD=macos
    script:
    - bash .travis/script-macos.sh
    - cp -av bin ninjas2-"$_BUILD"
    - rm -f ninjas2-"$_BUILD"/README
    - install -d release
    - zip -9 -r release/ninjas2-"$_BUILD".zip ninjas2-"$_BUILD"
before_deploy:
- |
  if test "$TRAVIS_BRANCH" = "master" -a "$TRAVIS_PULL_REQUEST" = "false"; then
    export TRAVIS_TAG=automatic
    git tag -f "$TRAVIS_TAG"
  fi
deploy:
  provider: releases
  api_key: "$GITHUB_TOKEN"
  file: release/*
  file_glob: true
  skip_cleanup: true
  prerelease: true
  overwrite: true
  on:
    branch: master
env:
  global:
  - secure: KQIx0K9HNyKwGW793K6LzGIY38E9Ax2JLyzzu62T/u1JGQYSZ0z4V4suVzMcDAPbq1dsmn6ni4jEWPJyC7jgwwAdU52tv7YqYIXAf1ZbnbPL3Tykuh3DPNKwGVlimZzd4gl7C+Qg+gMYdu0mVYceB0i+T6F+U/O23sTwDsX7rtpegEj56jRPc5+VCjpNTDnGifHvtNaXgnPMx6Gf9nW/IsXNCGfdnQSPLPGHnNLmNLJvIJX3AbXgTgE66vT8+8ZcGcTg3W5YKOp6qnEUb3fo8qFdrG39yKBdf4qguy2zSAktPVozn7GshyCmo6GtLbPcti+nLN/BfcqJvazb3NWJ2ivevg/FnNxQtu8/UCB4gLIS+LRsvndhGT/FcpnW/WhOolgmQJnwFPU/0sRY63/gixWWN3/wzX/2mwwbkFWbJ6nYW0sO7YR4YCrEwzxAVF8ZzoWVvZFFLt2vkEGK1/rnWGca3+Xx3LPudnIa3dbvlVhJWYzLpWshHa+YdZtB0G34t2azquMIQVbll1EpgiuE0slZ1SIKnMqGftLxsDPq2gAc1Zu7g9mx4IzsHBoDaVI5ENr+X6iT6KMLEJWJJJbrn+zTSHu0L+ITjdkr2YA6IXYVQoie7lcjh2j7iMs4Jsc/RO+nbBtegUImAfrmD3bsku/BXGpZYKmeg2F6+eCJM+Q=
  - secure: pTug+hggswoiMGXKiqV/azqDfVOJxDTG4u0R0R2qG3rRdp8IqtojtvFmcEtm7OMsA1db0Ls5awTNpFH9iS5e590CP9iXYLHH9aWx9w0CeotdInuP3ANhYWEFw96VOVFn/3sBrDHS8H26a4H0DmHikTRZOartyUshy2/3pi9UAptjt39rPsQIjiKThS9G2vQaV1MeWKc82gLnQIjT7QT6m/003Wv0Ars1zktutrRZhcHwh+MFr89rizmdbVX1pMC9VqG5Iq0XLxoHbE7+E5Y57WyRbITfC6uw4j+5x+cCY1l9u/WY1/KTGkBYlxO0zIrdSlLma+sxlUYMtTex6nkFuwk6qPKK6+Wh+HD8YquBispisJ18RH3zNTeh3rziHwGxr6v2YM5EGOWg/8YoTcGQGe/NEPS11kT6YTxfVgzh3YbsEgw22uLBIsf8JLKKGgvTXPTNnwTJ+27P7UrWgkk3CG2mEtcBcVH9ohwVhKeoQ+4zLT4vad0Y0p34StGwlSZBgq2h2Kqt2vVFEakZHUMmRDNLcIj/zhW2qOj0ZWvYu2Kd7QO4f5Kb4u9hHiJca94s7tCnhwEUQXpcnig5MtVrkcJ9+6IHirkGE9AxVT0hT2TuBPVVw06s1z+wUo+GRlUJbxQLBAqK3CZG/XSEK6MsFtsqgZo7uDhgSbbnY6TBTlI=
